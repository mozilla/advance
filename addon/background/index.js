!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=12)}([function(e,t,n){"use strict";(function(e){n.d(t,"g",function(){return i}),n.d(t,"h",function(){return s}),n.d(t,"f",function(){return a}),n.d(t,"c",function(){return u}),n.d(t,"a",function(){return c}),n.d(t,"d",function(){return l}),n.d(t,"e",function(){return h}),n.d(t,"b",function(){return d}),n.d(t,"i",function(){return f});var r=n(2);const i="object"==typeof e&&!("boolean"==typeof __DEV__&&!0===__DEV__);var o=!i;function s(e){o&&console.log(`production:${i} `+e)}function a(e){o&&console.error(e)}const u=i?"https://laserlike.com":"http://localhost:3000",c=void 0,l=i?"https://feed.laserlike.com":"https://feed-dev.laserlike.com",h=i?"https://feed.laserlike.com":"http://localhost:3000",d={apiServer:"api_server_url",webServer:"web_server_url",extensionOrigin:"extension_origin",userID:r.d.userId,token:r.d.token,compactMode:"compact_mode",paused:"paused",userDisplayName:"user_display_name",accountDeleted:"account_deleted",newTabUrl:"new_tab_url",ignoreDNT:"ignore_do_not_track"};function f(e){if(!e)return"";return(e=e.split("#")[0]).startsWith("about:reader?url=")?e=decodeURIComponent(e.slice("about:reader?url=".length)):(e.startsWith("about:")||e.startsWith("chrome:")||e.startsWith("chrome-extension:")||""===e)&&(e=r.c),e}}).call(this,n(3))},function(e,t,n){"use strict";n.d(t,"c",function(){return i}),n.d(t,"b",function(){return o}),n.d(t,"a",function(){return s}),n.d(t,"d",function(){return a});var r=n(0);async function i(e,t){Object(r.h)(`set persistent data in extension: ${e} = ${t}`);const n={name:e,value:t,url:r.c,expirationDate:2147483647},i=await browser.cookies.set(n);return Object(r.h)(`cookie set: ${JSON.stringify(i)}`),!!i}async function o(e){Object(r.h)(`read extension cookie: ${e} for url: ${r.c}`);const t={name:e,url:r.c},n=await browser.cookies.get(t);return Object(r.h)(`cookie read: ${JSON.stringify(n)}`),n?n.value:void 0}async function s(e){Object(r.h)(`delete extension cookie: ${e} for url: ${r.c}`);const t={name:e,url:r.c};return!!await browser.cookies.remove(t)}const a={myWindowId:null,paused:!1,userId:0,authToken:"",isLoggingIn:!1,accountDeleted:!1,newTabUrl:void 0,ignoreDNT:!1,API_SERVER:r.d,WEB_SERVER:r.e,activeTabs:{},focusedWindowId:-1,fetchRequestCredentials:"include"}},function(e,t,n){"use strict";let r;n.d(t,"c",function(){return u}),n.d(t,"d",function(){return d}),n.d(t,"b",function(){return f}),n.d(t,"a",function(){return p});const i=3e5,o=36e5,s=3600,a=1e7,u="FOR_YOU",c={get login(){return`${r.apiServer}/auth/api/v1/login`},get updateEmail(){return`${r.apiServer}/auth/api/v1/update-email`},get emailValidate(){return`${r.apiServer}/auth/api/v1/email/validate`},get sendVerification(){return`${r.apiServer}/auth/api/v1/email/sendverification?verification_method=2`},get deleteAccount(){return`${r.apiServer}/auth/api/v1/delete-account`},get preferences(){return`${r.apiServer}/auth/api/v1/user/preferences`},get managePreferences(){return`${r.apiServer}/auth/api/v1/user/manage-preferences`},get log(){return`${r.apiServer}/logging/api/v1/log`},get trendfeed(){return`${r.apiServer}/searchlike/api/v1/trendfeed`},get related(){return`${r.apiServer}/searchlike/api/v1/related`},get profile(){return`${r.apiServer}/searchlike/api/v1/profile`},get getProfile(){return`${r.apiServer}/searchlike/api/v1/get_profile`},get defaultTab(){return`${r.webServer}/`},get downloadData(){return`${r.apiServer}/account/data/download/`}},l={email:"Email Feedback",notInteresting:"Not Interesting",offTopic:"Off-Topic / Spam",block:"Block"},h={DEFAULT:0,FALSE:1,CONFIRMED:2},d={userId:"user_id",token:"token"};class f{constructor(e,t,n,r,i,o,s,a,u,c){this.clientInfo=e,this.apiServer=t,this.webServer=n,this.LRU=r,this.debugMode=i,this.setPersistData=o,this.getPersistData=s,this.deletePersistData=a,this.Log=u,this.Error=c}}class p{constructor(e){e.Log(`new client... ${e.clientInfo}`),r=e,this.isLoggingIn=!1,this.previousReadUrl=void 0,this.previousReadTime=void 0,this.feedCache=new b(this),this.pendingLogins=[],this.checkLogin=(async()=>{this.userId=await r.getPersistData(d.userId),this.authToken=await r.getPersistData(d.token)}),this.checkLogin()}isLoggedIn(){return this.userId&&this.authToken}async fetchRelated(e){r.Log(`async fetchRelated ${e}`);let t=this.feedCache.get(e,this.authToken,!0);if(Promise.resolve(t)!==t){return r.Log(`use existing ${e} feed`),t.removeCardsWithFeedback().cards}{r.Log(`start new fetch request ${e}`);let n=await t;return r.Log(`end fetch ${e}`),n.removeCardsWithFeedback().cards}}async fetchForYou(){if(this.isLoggedIn()){let e=this.feedCache.get(u,this.authToken,!0);if(Promise.resolve(e)!==e){return r.Log("use existing foryou feed"),e.removeCardsWithFeedback().cards}return r.Log("start new for you request"),(await e).removeCardsWithFeedback().cards}return this.login(),[]}handle401(){r.Error("401: reject by server"),this.userId=void 0,this.authToken=void 0,r.deletePersistData(d.userId),r.deletePersistData(d.token),this.previousReadUrl=void 0,this.previousReadTime=void 0,this.login()}logReadCard(e,t,n,r){if(!this.isLoggedIn())return void this.login();const i={eventType:"start",deviceTimeUnixMicros:1e3*Date.now(),read:{cardURL:e,uiElement:"browser",position:t,feed_type:n,logging_tags:r}};this.sendLog([i])}logReadStart(e){if(!this.isLoggedIn())return void this.login();const t=Date.now();var n=[{eventType:"start",deviceTimeUnixMicros:1e3*t,read:{cardURL:e,uiElement:"browser"}}];if(this.previousReadTime&&this.previousReadUrl){const e={cardURL:this.previousReadUrl,uiElement:"browser"};n.push({eventType:"end",deviceTimeUnixMicros:1e3*t,deviceDurationMicros:1e3*(t-this.previousReadTime),read:e})}this.previousReadTime=t,this.previousReadUrl=e,this.sendLog(n)}logReadEnd(e,t){if(!this.isLoggedIn())return void this.login();const n=Date.now(),r={eventType:"end",deviceTimeUnixMicros:1e3*n,deviceDurationMicros:1e3*(n-t),read:{cardURL:e,uiElement:"browser"}};this.sendLog([r])}setUserDisplayName(e,t){var n={name:e};let i={method:"POST",headers:new Headers({Accept:"application/json",Authorization:`Token ${this.authToken}`}),body:JSON.stringify(n),credentials:"include"},o=new Request(c.profile,i);return fetch(o).then(e=>{r.Log(`names returned ${e.status}`),t(e)})}sendLog(e){let t=[];for(let n=0;n<e.length;n++)t.push({clientInfo:r.clientInfo,userActivity:e[n]});const n={entries:t};let i={method:"POST",headers:new Headers({Accept:"application/json",Authorization:`Token ${this.authToken}`}),body:JSON.stringify(n),credentials:"include"},o=new Request(c.log,i);return fetch(o).then(e=>(r.Log(`logging returned ${e.status}`),401===e.status&&this.handle401(),200===e.status))}deleteAccount(e,t){const n=new Headers({Accept:"application/json",Authorization:`Token ${this.authToken}`}),i=new Request(c.deleteAccount,{method:"POST",headers:n,body:"{}",credentials:"include"});return r.Log("BG$ deleting account...."),fetch(i).then(n=>{200===n.status?e():t(n.status)}).catch(e=>{Error(`BG$ delete account error: ${e}`),t(999,e)})}validateUserEmail(e,t,n,i){var o={id:e,passcode:t};let s={method:"POST",headers:new Headers({Accept:"application/json",Authorization:`Token ${this.authToken}`}),body:JSON.stringify(o),credentials:"include"},a=new Request(c.emailValidate,s);return fetch(a).then(e=>{r.Log(`validate code returned ${e.status}`),200===e.status?n():e.json().then(t=>{r.Log(`error json: ${t}`),i(e.status,t.error)})}).catch(e=>{i(999,e)})}manageUserPreferences(e,t,n){var i={email:{unsubscription_map:{EmailDigest:e?2:1}}};const o=new Headers({Accept:"application/json",Authorization:`Token ${this.authToken}`}),s=new Request(c.managePreferences,{method:"POST",headers:o,body:JSON.stringify(i),credentials:"include"});return r.Log("updating user preferences...."),fetch(s).then(e=>{200===e.status?t():n(e.status)}).catch(e=>{Error(`updating user preferences error: ${e}`),n(999,e)})}updateUserEmail(e,t,n){var i={email:e,verification_method:2};let o={method:"POST",headers:new Headers({Accept:"application/json",Authorization:`Token ${this.authToken}`}),body:JSON.stringify(i),credentials:"include"},s=new Request(c.updateEmail,o);return fetch(s).then(i=>{r.Log(`update email returned ${i.status}`),200===i.status?t(e,!1):i.json().then(e=>{r.Log(`error json: ${e}`),n(i.status,e.error)})}).catch(e=>{n(999,e)})}resendEmailVerification(e,t){r.Log("resend email verification");let n={method:"GET",headers:new Headers({Accept:"application/json",Authorization:`Token ${this.authToken}`}),credentials:"include"},i=new Request(c.sendVerification,n);return fetch(i).then(n=>{200===n.status?e():n.json().then(e=>{r.Log(`error json: ${e}`),t(n.status,e.error)})}).catch(e=>{t(999,e)})}fetchUserProfile(e,t){r.Log("fetch user profile...");let n={method:"GET",headers:new Headers({Accept:"application/json",Authorization:`Token ${this.authToken}`}),credentials:"include"},i=new Request(c.getProfile,n);return fetch(i).then(n=>{r.Log(`fetch user profile result: ${n.status}`),200===n.status?n.json().then(t=>{const n=t.email_confirmed===h.CONFIRMED,i=t.email||"";r.Log(`email: ${i}, confirmed: ${n}`),e(i,n)}):t(n.status)}).catch(e=>{t(999,e)})}fetchUserPreferences(e,t){r.Log("fetch user preferences...");let n={method:"GET",headers:new Headers({Accept:"application/json",Authorization:`Token ${this.authToken}`}),credentials:"include"},i=new Request(c.preferences,n);return fetch(i).then(n=>{r.Log(`fetch user preferences result: ${n.status}`),200===n.status?n.json().then(t=>{let n=!1;const r=t.email_preferences;if(r){r.settings.forEach(e=>{8===e.type&&(n=e.subscribed)})}e(n)}):t(n.status)}).catch(e=>{t(999,e)})}loginInternal(e,t){var n={social_flag:"firefox"};r.debugMode?(n.oauth_token="laserlike-test-device-id",r.Log("login in as new test user ....")):r.Log("login in as new user ....");let i=new Headers({Accept:"application/json"}),o={method:"POST",body:JSON.stringify(n),headers:i,credentials:"include"},s=new Request(c.login,o);return fetch(s).then(n=>{r.Log(`login returned ${n.status}`),200===n.status?n.json().then(n=>{r.Log(JSON.stringify(n)),n.user_id&&n.auth_token?e(n.user_id,n.auth_token):t(999,"unknown response")}):t(n.status)}).catch(e=>{t(998,e)})}login(e,t,n=0){if(this.userId&&this.authToken)return void(e&&e(this.userId,this.authToken));if(e&&this.pendingLogins.push({success:e,failure:t}),this.isLoggingIn)return;this.isLoggingIn=!0;this.loginInternal((e,t)=>{for(this.isLoggingIn=!1,this.userId=e,this.authToken=t,r.setPersistData(d.userId,this.userId),r.setPersistData(d.token,this.authToken),r.Log(`got user id: ${this.userId} token: ${this.authToken}`),this.feedCache.get(u,this.authToken,!0);this.pendingLogins.length>0;){const e=this.pendingLogins.shift();e.success&&e.success(this.userId,this.authToken)}},(e,t)=>{if(r.Error(`login failed: ${e}, ${t}`),this.isLoggingIn=!1,n>22){for(;this.pendingLogins.length>0;){const e=this.pendingLogins.pop();e.failure&&e.failure()}return}(n*=2)<1&&(n=1);let i=1e3*n;i>72e5&&(i=72e5),setTimeout(()=>{this.login(void 0,void 0,n)},i)})}blockCardsFromHostExcept(e,t){this.feedCache.cache.values().forEach(n=>{n.cards.forEach(n=>{n.host===e&&n.card_id!==t.card_id&&(r.Log(`block ${t.title}`),n.sentFeedback=l.block)})})}}class g{constructor(e){const{card_id:t,position:n,url:r,orig_url:i,title:o,host:s,display_host:a,description:u,card_age_time_sec:c,article:l,feed_type:h,logging_tags:d}=e;this.card_id=t,this.position=n,this.url=r,this.orig_url=i,this.title=o,this.host=a||s,this.description=u,this.card_age_time_sec=c,this.image_url=l.image_url,this.feed_type=h,this.logging_tags=d,this.sentFeedback=void 0}get elementId(){return`card-${this.card_id}`}get unoElementId(){return`undo-${this.card_id}`}emailBody(e,t,n){return`{\n      userId: ${e},\n      display_name: ${t}\n      email: ${n}\n      card:\n      { card_id: ${this.card_id},\n        position: ${this.position},\n        url: "${this.url}",\n        orig_url: "${this.orig_url}",\n        host: ${this.host},\n        card_age_time_sec: ${this.card_age_time_sec},\n        image_url: "${this.image_url}",\n      },\n    }`}get length(){return JSON.stringify(this).length}}class v{constructor(e,t){this.url=e,this.count=t.count,this.fetchTime=Date.now(),this.ttl=t.ttl||0,this.cards=(t.cards||[]).map(e=>new g(e))}expired(){if(this.url===u){const e=Math.max(i,this.ttl);return Date.now()-this.fetchTime>e}return Date.now()-this.fetchTime>o}length(){return this.cards&&this.url?this.url.length+this.cards.reduce(function(e,t){return e+t.length},0):0}removeCardsWithFeedback(){return r.Log(`removeCardsWithFeedback: feed ${this.url} has ${this.cards.length} cards`),this.cards=this.cards.filter(e=>!e.sentFeedback),r.Log(`feed ${this.url} has ${this.cards.length} cards`),this}}class b{constructor(e){this.core=e,this.cache=r.LRU({max:a,length:(e,t)=>e.length()+t.length}),this.fetchPromises=r.LRU({max:100,maxAge:6e4})}clear(){this.cache.reset(),this.fetchPromises.reset()}get(e,t,n){let i=this.cache.get(e);const o=!i||i&&i.expired();r.Log(`FeedCache$ get ${e}, fetching: ${o}`);let s=this.fetchPromises.get(e);return!s&&o&&(s=this.fetchFeed(e,t,n),this.fetchPromises.set(e,s)),i&&!o?i:s}set(e,t){r.Log(`FeedCache$ saving feed ${e}`);let n=new v(e,t);return this.cache.get(u),this.cache.set(e,n),n}fetchFeed(e,t,n,i=1){r.Log(`FeedCache$ fetching ${e} token: ${t}, ${n}...`);let o,a=new Headers({Accept:"application/json",Authorization:`Token ${t}`});if(e===u){let e={method:"POST",body:JSON.stringify({client_info:r.clientInfo,tf_trend:{key:{type:2}},last_card_pos:"0"}),headers:a,credentials:"include"};o=new Request(c.trendfeed,e),i=0}else{let t={method:"POST",body:JSON.stringify({client_info:r.clientInfo,search_like:{vibe:[{target:{target:`u:${e}`}}]}}),headers:a,credentials:n?"include":"omit"};o=new Request(c.related,t)}return r.Log(`FeedCache$ before fetch: ${c.related}`),fetch(o).then(t=>{if(r.Log(`FeedCache$ fetch response: ${t.status} for ${c.related}`),401!==t.status)return 200===t.status?t.json().then(t=>{let n={cards:t.cards||[],ttl:1e3*(t.ttl||0)};return n.cards=n.cards.filter(e=>!!e.article&&!!e.orig_url),e!==u?(n.count=(t.search_like||{}).num_results_to_show_first||n.cards.length,n.count=Math.min(n.count,4)):n.count=n.cards.length,r.Log(`FeedCache$ got ${n.cards.length} new ${e} cards`),i&&n.ttl&&n.ttl<s&&(r.Log(`FeedCache$ retry in ${n.ttl} seconds`),setTimeout(()=>this.fetchFeed(e,i-1),n.ttl)),this.set(e,n)}):(r.Error(`FeedCache$ Fetch failed ${t.statusText}`),new v(e,[]));this.core.handle401()})}}},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var u,c=[],l=!1,h=-1;function d(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&f())}function f(){if(!l){var e=a(d);l=!0;for(var t=c.length;t;){for(u=c,c=[];++h<t;)u&&u[h].run();h=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||l||a(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";e.exports=b;var r,i=n(11),o=n(9),s=n(6),a=(r="function"==typeof Symbol?function(e){return Symbol(e)}:function(e){return"_"+e})("max"),u=r("length"),c=r("lengthCalculator"),l=r("allowStale"),h=r("maxAge"),d=r("dispose"),f=r("noDisposeOnSet"),p=r("lruList"),g=r("cache");function v(){return 1}function b(e){if(!(this instanceof b))return new b(e);"number"==typeof e&&(e={max:e}),e||(e={});var t=this[a]=e.max;(!t||"number"!=typeof t||t<=0)&&(this[a]=1/0);var n=e.length||v;"function"!=typeof n&&(n=v),this[c]=n,this[l]=e.stale||!1,this[h]=e.maxAge||0,this[d]=e.dispose,this[f]=e.noDisposeOnSet||!1,this.reset()}function m(e,t,n,r){var i=n.value;w(e,i)&&(k(e,n),e[l]||(i=void 0)),i&&t.call(r,i.value,i.key,e)}function y(e,t,n){var r=e[g].get(t);if(r){var i=r.value;w(e,i)?(k(e,r),e[l]||(i=void 0)):n&&e[p].unshiftNode(r),i&&(i=i.value)}return i}function w(e,t){if(!t||!t.maxAge&&!e[h])return!1;var n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[h]&&n>e[h]}function $(e){if(e[u]>e[a])for(var t=e[p].tail;e[u]>e[a]&&null!==t;){var n=t.prev;k(e,t),t=n}}function k(e,t){if(t){var n=t.value;e[d]&&e[d](n.key,n.value),e[u]-=n.length,e[g].delete(n.key),e[p].removeNode(t)}}Object.defineProperty(b.prototype,"max",{set:function(e){(!e||"number"!=typeof e||e<=0)&&(e=1/0),this[a]=e,$(this)},get:function(){return this[a]},enumerable:!0}),Object.defineProperty(b.prototype,"allowStale",{set:function(e){this[l]=!!e},get:function(){return this[l]},enumerable:!0}),Object.defineProperty(b.prototype,"maxAge",{set:function(e){(!e||"number"!=typeof e||e<0)&&(e=0),this[h]=e,$(this)},get:function(){return this[h]},enumerable:!0}),Object.defineProperty(b.prototype,"lengthCalculator",{set:function(e){"function"!=typeof e&&(e=v),e!==this[c]&&(this[c]=e,this[u]=0,this[p].forEach(function(e){e.length=this[c](e.value,e.key),this[u]+=e.length},this)),$(this)},get:function(){return this[c]},enumerable:!0}),Object.defineProperty(b.prototype,"length",{get:function(){return this[u]},enumerable:!0}),Object.defineProperty(b.prototype,"itemCount",{get:function(){return this[p].length},enumerable:!0}),b.prototype.rforEach=function(e,t){t=t||this;for(var n=this[p].tail;null!==n;){var r=n.prev;m(this,e,n,t),n=r}},b.prototype.forEach=function(e,t){t=t||this;for(var n=this[p].head;null!==n;){var r=n.next;m(this,e,n,t),n=r}},b.prototype.keys=function(){return this[p].toArray().map(function(e){return e.key},this)},b.prototype.values=function(){return this[p].toArray().map(function(e){return e.value},this)},b.prototype.reset=function(){this[d]&&this[p]&&this[p].length&&this[p].forEach(function(e){this[d](e.key,e.value)},this),this[g]=new i,this[p]=new s,this[u]=0},b.prototype.dump=function(){return this[p].map(function(e){if(!w(this,e))return{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}},this).toArray().filter(function(e){return e})},b.prototype.dumpLru=function(){return this[p]},b.prototype.inspect=function(e,t){var n="LRUCache {",r=!1;this[l]&&(n+="\n  allowStale: true",r=!0);var i=this[a];i&&i!==1/0&&(r&&(n+=","),n+="\n  max: "+o.inspect(i,t),r=!0);var s=this[h];s&&(r&&(n+=","),n+="\n  maxAge: "+o.inspect(s,t),r=!0);var d=this[c];d&&d!==v&&(r&&(n+=","),n+="\n  length: "+o.inspect(this[u],t),r=!0);var f=!1;return this[p].forEach(function(e){f?n+=",\n  ":(r&&(n+=",\n"),f=!0,n+="\n  ");var i=o.inspect(e.key).split("\n").join("\n  "),a={value:e.value};e.maxAge!==s&&(a.maxAge=e.maxAge),d!==v&&(a.length=e.length),w(this,e)&&(a.stale=!0),a=o.inspect(a,t).split("\n").join("\n  "),n+=i+" => "+a}),(f||r)&&(n+="\n"),n+="}"},b.prototype.set=function(e,t,n){var r=(n=n||this[h])?Date.now():0,i=this[c](t,e);if(this[g].has(e)){if(i>this[a])return k(this,this[g].get(e)),!1;var o=this[g].get(e).value;return this[d]&&(this[f]||this[d](e,o.value)),o.now=r,o.maxAge=n,o.value=t,this[u]+=i-o.length,o.length=i,this.get(e),$(this),!0}var s=new function(e,t,n,r,i){this.key=e,this.value=t,this.length=n,this.now=r,this.maxAge=i||0}(e,t,i,r,n);return s.length>this[a]?(this[d]&&this[d](e,t),!1):(this[u]+=s.length,this[p].unshift(s),this[g].set(e,this[p].head),$(this),!0)},b.prototype.has=function(e){return!!this[g].has(e)&&!w(this,this[g].get(e).value)},b.prototype.get=function(e){return y(this,e,!0)},b.prototype.peek=function(e){return y(this,e,!1)},b.prototype.pop=function(){var e=this[p].tail;return e?(k(this,e),e.value):null},b.prototype.del=function(e){k(this,this[g].get(e))},b.prototype.load=function(e){this.reset();for(var t=Date.now(),n=e.length-1;n>=0;n--){var r=e[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{var o=i-t;o>0&&this.set(r.k,r.v,o)}}},b.prototype.prune=function(){var e=this;this[g].forEach(function(t,n){y(e,n,!1)})}},,function(e,t){function n(e){var t=this;if(t instanceof n||(t=new n),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach(function(e){t.push(e)});else if(arguments.length>0)for(var r=0,i=arguments.length;r<i;r++)t.push(arguments[r]);return t}function r(e,t){e.tail=new o(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function i(e,t){e.head=new o(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function o(e,t,n,r){if(!(this instanceof o))return new o(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}e.exports=n,n.Node=o,n.create=n,n.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null},n.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},n.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},n.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)r(this,arguments[e]);return this.length},n.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)i(this,arguments[e]);return this.length},n.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},n.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},n.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;null!==n;r++)e.call(t,n.value,r,this),n=n.next},n.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;null!==n;r--)e.call(t,n.value,r,this),n=n.prev},n.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},n.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},n.prototype.map=function(e,t){t=t||this;for(var r=new n,i=this.head;null!==i;)r.push(e.call(t,i.value,this)),i=i.next;return r},n.prototype.mapReverse=function(e,t){t=t||this;for(var r=new n,i=this.tail;null!==i;)r.push(e.call(t,i.value,this)),i=i.prev;return r},n.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=e(n,r.value,i),r=r.next;return n},n.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=e(n,r.value,i),r=r.prev;return n},n.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},n.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},n.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new n;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,o=this.head;null!==o&&i<e;i++)o=o.next;for(;null!==o&&i<t;i++,o=o.next)r.push(o.value);return r},n.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new n;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,o=this.tail;null!==o&&i>t;i--)o=o.prev;for(;null!==o&&i>e;i--,o=o.prev)r.push(o.value);return r},n.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t,n){(function(e){var r=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,o=i.length,a=String(e).replace(r,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}}),u=i[n];n<o;u=i[++n])p(u)||!y(u)?a+=" "+u:a+=" "+s(u);return a},t.deprecate=function(n,r){if(b(global.process))return function(){return t.deprecate(n,r).apply(this,arguments)};if(!0===e.noDeprecation)return n;var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),i=!0}return n.apply(this,arguments)}};var i,o={};function s(e,n){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),f(n)?r.showHidden=n:n&&t._extend(r,n),b(r.showHidden)&&(r.showHidden=!1),b(r.depth)&&(r.depth=2),b(r.colors)&&(r.colors=!1),b(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=a),c(r,e,r.depth)}function a(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function u(e,t){return e}function c(e,n,r){if(e.customInspect&&n&&k(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return v(i)||(i=c(e,i,r)),i}var o=function(e,t){if(b(t))return e.stylize("undefined","undefined");if(v(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(g(t))return e.stylize(""+t,"number");if(f(t))return e.stylize(""+t,"boolean");if(p(t))return e.stylize("null","null")}(e,n);if(o)return o;var s=Object.keys(n),a=function(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(n)),$(n)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return l(n);if(0===s.length){if(k(n)){var u=n.name?": "+n.name:"";return e.stylize("[Function"+u+"]","special")}if(m(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(w(n))return e.stylize(Date.prototype.toString.call(n),"date");if($(n))return l(n)}var y,O="",_=!1,T=["{","}"];(d(n)&&(_=!0,T=["[","]"]),k(n))&&(O=" [Function"+(n.name?": "+n.name:"")+"]");return m(n)&&(O=" "+RegExp.prototype.toString.call(n)),w(n)&&(O=" "+Date.prototype.toUTCString.call(n)),$(n)&&(O=" "+l(n)),0!==s.length||_&&0!=n.length?r<0?m(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),y=_?function(e,t,n,r,i){for(var o=[],s=0,a=t.length;s<a;++s)j(t,String(s))?o.push(h(e,t,n,r,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(h(e,t,n,r,i,!0))}),o}(e,n,r,a,s):s.map(function(t){return h(e,n,r,a,t,_)}),e.seen.pop(),function(e,t,n){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(y,O,T)):T[0]+O+T[1]}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,n,r,i,o){var s,a,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(a=e.stylize("[Setter]","special")),j(r,i)||(s="["+i+"]"),a||(e.seen.indexOf(u.value)<0?(a=p(n)?c(e,u.value,null):c(e,u.value,n-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),b(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function d(e){return Array.isArray(e)}function f(e){return"boolean"==typeof e}function p(e){return null===e}function g(e){return"number"==typeof e}function v(e){return"string"==typeof e}function b(e){return void 0===e}function m(e){return y(e)&&"[object RegExp]"===O(e)}function y(e){return"object"==typeof e&&null!==e}function w(e){return y(e)&&"[object Date]"===O(e)}function $(e){return y(e)&&("[object Error]"===O(e)||e instanceof Error)}function k(e){return"function"==typeof e}function O(e){return Object.prototype.toString.call(e)}function _(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(b(i)&&(i=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!o[n])if(new RegExp("\\b"+n+"\\b","i").test(i)){var r=e.pid;o[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,r,e)}}else o[n]=function(){};return o[n]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=d,t.isBoolean=f,t.isNull=p,t.isNullOrUndefined=function(e){return null==e},t.isNumber=g,t.isString=v,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=b,t.isRegExp=m,t.isObject=y,t.isDate=w,t.isError=$,t.isFunction=k,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(8);var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function j(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,n;console.log("%s - %s",(e=new Date,n=[_(e.getHours()),_(e.getMinutes()),_(e.getSeconds())].join(":"),[e.getDate(),T[e.getMonth()],n].join(" ")),t.format.apply(t,arguments))},t.inherits=n(7),t._extend=function(e,t){if(!t||!y(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,n(3))},function(e,t){var n=Object.prototype.hasOwnProperty;function r(e){if(!(this instanceof r))throw new TypeError("Constructor PseudoMap requires 'new'");if(this.clear(),e)if(e instanceof r||"function"==typeof Map&&e instanceof Map)e.forEach(function(e,t){this.set(t,e)},this);else{if(!Array.isArray(e))throw new TypeError("invalid argument");e.forEach(function(e){this.set(e[0],e[1])},this)}}function i(e,t){return e===t||e!=e&&t!=t}function o(e,t){for(var r=0,o="_"+t,s=o;n.call(e,s);s=o+r++)if(i(e[s].key,t))return e[s]}e.exports=r,r.prototype.forEach=function(e,t){t=t||this,Object.keys(this._data).forEach(function(n){"size"!==n&&e.call(t,this._data[n].value,this._data[n].key)},this)},r.prototype.has=function(e){return!!o(this._data,e)},r.prototype.get=function(e){var t=o(this._data,e);return t&&t.value},r.prototype.set=function(e,t){!function(e,t,r){for(var o=0,s="_"+t,a=s;n.call(e,a);a=s+o++)if(i(e[a].key,t))return void(e[a].value=r);e.size++,e[a]=new function(e,t,n){this.key=e,this.value=t,this._index=n}(t,r,a)}(this._data,e,t)},r.prototype.delete=function(e){var t=o(this._data,e);t&&(delete this._data[t._index],this._data.size--)},r.prototype.clear=function(){var e=Object.create(null);e.size=0,Object.defineProperty(this,"_data",{value:e,enumerable:!1,configurable:!0,writable:!1})},Object.defineProperty(r.prototype,"size",{get:function(){return this._data.size},set:function(e){},enumerable:!0,configurable:!0}),r.prototype.values=r.prototype.keys=r.prototype.entries=function(){throw new Error("iterators are not implemented in this version")}},function(e,t,n){(function(t){"pseudomap"===t.env.npm_package_name&&"test"===t.env.npm_lifecycle_script&&(t.env.TEST_PSEUDOMAP="true"),"function"!=typeof Map||t.env.TEST_PSEUDOMAP?e.exports=n(10):e.exports=Map}).call(this,n(3))},function(e,t,n){"use strict";n.r(t);var r=n(4),i=n.n(r),o=n(0),s=n(1),a=n(2);let u;var c,l=new Map;function h(e){return["about:newtab","about:home"].indexOf(e)>=0}function d(e,t,n,r=!1){if("1"===navigator.doNotTrack&&!s.d.ignoreDNT)return Object(o.h)("do not track enabled, return"),void f(t,0);browser.windows.getLastFocused().then(i=>{if(Object(o.h)(`Window is private: ${i.incognito}`),i.incognito)return Object(o.h)("this is private window, return"),void f(t,0);const c=Object(o.i)(n),l=s.d.activeTabs[e];if(l)if(l.url!==c||r)if(s.d.activeTabs[e]={tabId:l.tabId,url:c},browser.runtime.sendMessage({method:"newUrl",windowId:e,url:n,normalizedUrl:c}),s.d.paused||s.d.accountDeleted)Object(o.h)(`BG$ extension disabled ${s.d.paused} ${s.d.accountDeleted}`);else if(c!==a.c){(async()=>{Object(o.h)(`fetch related feed in window ${e} to: ${n} ${c}`);const r=await u.fetchRelated(c);Object(o.h)(`.... got ${r.length} cards`),c===s.d.activeTabs[e].url&&(Object(o.h)("update badge"),f(t,r.length,c))})()}else Object(o.h)("ignoring for you feed in the background"),f(t,0);else Object(o.h)(`BG$ same url: ${c}`);else Object(o.f)("Internal error, should never happend!")})}function f(e,t,n){if(void 0===e)return;if(!t)return void browser.browserAction.setBadgeText({tabId:e,text:""});let r="green",i=t.toString();if(n==a.c){let e=Date.now()/1e3;c&&e-c<28800&&(i=""),r="red"}browser.browserAction.setBadgeText({tabId:e,text:i}),browser.browserAction.setBadgeBackgroundColor({color:r})}function p(e,t,n=2147483647){Object(o.h)(`setcookie: ${o.a} ${e}, ${t}`);let r={url:o.c,name:e,value:t};o.a&&(r.domain=o.a,r.firstPartyDomain=o.a),0!=n&&(r.expirationDate=n),browser.cookies.set(r)}function g(e){const t=e.cookie;Object(o.h)(`cookie changed: ${JSON.stringify(e)}`),!t||t.domain!==o.a&&"localhost"!==t.domain||(t.name===o.b.apiServer?s.d.API_SERVER=t.value:t.name===o.b.webServer?s.d.WEB_SERVER=t.value:t.name===o.b.newTabUrl?(e.removed?(Object(o.h)("unset laserlike from home page"),s.d.newTabUrl=void 0):(s.d.newTabUrl=t.value,Object(o.h)(`set home to: ${s.d.newTabUrl}`)),browser.runtime.sendMessage({method:"homePageChanged"})):t.name===o.b.accountDeleted?e.removed?(s.d.accountDeleted=!1,browser.runtime.sendMessage({method:"loggedOut"})):(s.d.accountDeleted=!0,browser.runtime.sendMessage({method:"loggedIn"})):t.name===o.b.paused?(e.removed?s.d.paused=!0:s.d.paused="true"===t.value,browser.runtime.sendMessage({method:"pauseStateChanged"})):t.name===o.b.token?(e.removed?s.d.authToken=void 0:s.d.authToken=t.value,u.checkLogin()):t.name===o.b.ignoreDNT&&(e.removed?s.d.ignoreDNT=!1:s.d.ignoreDNT="true"===t.value))}function v(e){l.set(e,Date.now()),setTimeout(()=>{let t=l.get(e);t&&Date.now()-t>1e3&&(Object(o.h)(`sidebar in ${e} is closed`),l.delete(e))},1100)}browser.tabs.onActivated.addListener(function(e){Object(o.h)(`BG$ activated a new tab: (${e.windowId}, ${e.tabId})`),b(e.tabId).then(t=>{Object(o.h)(t);const n=s.d.activeTabs[e.windowId];n||(s.d.activeTabs[e.windowId]={tabId:e.tabId,url:""}),d(e.windowId,e.tabId,t.url)})}),browser.tabs.onUpdated.addListener(function(e,t){if(!t.url)return;if(Object(o.h)(`BG$ update tab ${e}: ${t.url}`),h(t.url)&&s.d.newTabUrl){if(s.d.paused||s.d.accountDeleted)return;const t={loadReplace:!0,url:s.d.newTabUrl};var n=browser.tabs.update(e,t);n.then(Object(o.h)("update to laserlike done"))}else b(e).then(n=>{d(n.windowId,e,t.url)})}),browser.tabs.onCreated.addListener(function(e){if(Object(o.h)(`BG$ created new tab: ${e.url}`),s.d.paused||s.d.accountDeleted)return;if(s.d.newTabUrl&&h(e.url)){const n={loadReplace:!0,url:s.d.newTabUrl};var t=browser.tabs.update(e.id,n);t.then(Object(o.h)("set default to laserlike done"))}}),browser.runtime.onMessage.addListener(function(e){if(Object(o.h)(`BG$: got message: ${e}`),"iframeActive"==e.method)Object(o.h)(`iframe active windowId: ${e.windowId} ${e.uiElement} ${e.url}`),"/toolbar"==e.uiElement&&Object(o.i)(e.url)==a.c&&(c=Date.now()/1e3),s.d.accountDeleted?browser.runtime.sendMessage({method:"loggedOut"}):d(e.windowId,void 0,e.url,!0),v(e.windowId);else if("iframeAlive"==e.method)v(e.windowId);else if("read"==e.method){const t=e.card.orig_url||e.card.url;browser.tabs.create({url:t})}return Promise.resolve("Dummy response to keep the console quiet")}),window.onload=function(){s.d.fetchRequestCredentials="omit";const e=new a.b({product_enum:"TrendsAndFriends",os_type:"extension"},s.d.API_SERVER,s.d.WEB_SERVER,i.a,!o.g,s.c,s.b,s.a,o.h,o.f);u=new a.a(e),function(){return browser.storage.local.get("installed").then(function(e){if(browser.storage.local.set({installed:new Date}),e.installed)return Object(o.h)(`extension installed on: ${e.installed}`);{Object(o.h)("fresh install..."),browser.storage.local.set({installed:new Date});let e={url:o.c};o.a&&(e.firstPartyDomain=null);let t=browser.cookies.getAll(e);return t.then(e=>{function t(e){Object(o.h)(`Removed: ${e.name}`)}function n(e){Object(o.f)(`Error removing cookie: ${e}`)}Object(o.h)(`got ${e.length} old cookies`);var r=[];const i=Object.keys(o.b).map(e=>o.b[e]);if(e.length>0)for(let s of e)if(Object(o.h)(`got cookie: ${JSON.stringify(s)}`),i.indexOf(s.name)>=0){Object(o.h)(`remove cookie: ${JSON.stringify(s)}`);let e=browser.cookies.remove({name:s.name,url:o.c});o.a&&(e.firstPartyDomain=o.a),e.then(t,n),r.push(e)}return Object(o.h)(`removing ${r.length} old cookies`),Promise.all(r)})}},function(e){return Object(o.h)(`failed to get install: ${e}`),browser.storage.local.set({installed:new Date})})}().then(()=>{browser.tabs.query({}).then(e=>{!e||e.length<1?Object(o.h)("Error initializing: no tabs at all!"):e.forEach(function(e){Object(o.h)(`found tab: ${e.windowId} ${e.id}`),s.d.activeTabs[e.windowId]={tabId:e.id,url:""}})}),function(){let e={url:o.c};o.a&&(e.firstPartyDomain=null);Object(o.h)(`COOKIE_URL: ${o.c}, COOKIE_DOMAIN: ${o.a}`),browser.cookies.getAll(e).then(e=>{if(e.length>0){Object(o.h)(`got ${e.length} cookies`);for(let t of e)Object(o.h)(JSON.stringify(t)),t.name===o.b.apiServer?s.d.API_SERVER=t.value:t.name===o.b.webServer?s.d.WEB_SERVER=t.value:t.name===o.b.paused?s.d.paused="true"===t.value:t.name===o.b.accountDeleted?s.d.accountDeleted="true"===t.value:t.name===o.b.newTabUrl?s.d.newTabUrl=t.value:t.name===o.b.token?s.d.authToken=t.value:t.name===o.b.ignoreDNT&&(s.d.ignoreDNT="true"===t.value);p(o.b.apiServer,s.d.API_SERVER,0),p(o.b.webServer,s.d.WEB_SERVER,0)}else Object(o.h)("no cookies found!"),p(o.b.apiServer,s.d.API_SERVER,0),p(o.b.webServer,s.d.WEB_SERVER,0);p(o.b.extensionOrigin,browser.extension.getURL("/").slice(0,-1),0)})}(),browser.cookies.onChanged.addListener(g)})},browser.browserAction.onClicked.addListener(({windowId:e})=>{Object(o.h)(`browser action onClick window id: ${e}`),l.has(e)?(browser.sidebarAction.close(),l.delete(e)):browser.sidebarAction.open()});function b(e){return browser.tabs.query({active:!0}).then(t=>{for(var n=0;n<t.length;n++)if(t[n].id===e)return t[n]})}browser.menus.create({id:"searchLaserlikeId",title:"Search Laserlike for related",contexts:["selection","link"]}),browser.menus.onClicked.addListener(e=>{let t;if("searchLaserlikeId"===e.menuItemId){t=e.linkUrl?`url=${encodeURIComponent(e.linkUrl)}`:`q=${encodeURIComponent(e.selectionText)}`,browser.tabs.create({url:`${s.d.WEB_SERVER}/search?${t}`}).then(function(e){Object(o.h)(`Created new tab: ${e.id}`)},function(e){Object(o.h)(`Error: ${e}`)})}}),browser.menus.onShown.addListener(()=>{browser.menus.update("searchLaserlikeId",{title:"Search Laserlike for related"}),browser.menus.refresh()})}]);